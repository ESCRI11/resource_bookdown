# Statistical analyses from different resources

Let us start by illustrating how to peform simple statistical data analyses using different resources. Here, we will use data from three studies that are avaialbe in our OPAL test repository. The three databases are called CNSIM1, CNSIM2, CNSIM3 that are avaialble as three different resources: mySQL database, SPSS file and CSV file. This example mimics real situations were different hospital or research centers manage their own databases containing harmonized data. The analyses that are described here, can also be found in the [DataSHIELD Tutorial](https://data2knowledge.atlassian.net/wiki/spaces/DSDEV/pages/714571780/Tutorial+for+DataSHIELD+users+v5+-+http+bit.ly+intro-DS) where these resources where uploaded into the Opal server as three tables, a much worse approach since data have to be moved from original repositories.  

Let us start by illustrating how to analyze one data set. 


```{r cnsim1}
library(DSI)
library(DSOpal)
library(dsBaseClient)

# prepare login data and resource to assign
builder <- DSI::newDSLoginBuilder()
builder$append(server = "study1", url = "https://opal-test.obiba.org", 
               user = "dsuser", password = "password", 
               resource = "test.CNSIM2", driver = "OpalDriver")
logindata <- builder$build()

# login and assign resource
conns <- DSI::datashield.login(logins = logindata, assign = TRUE, 
                               symbol = "res")


# coerce ResourceClient objects to a data.frame called 'D'
datashield.assign.expr(conns, symbol = "D", 
                       expr = quote(as.resource.data.frame(res)))
```

Then we can inspect the type of data we have

```{r view_D}
ds.class("D")
ds.colnames("D")
```

Perform some data descriptive analyses

```{r descr_D}
ds.table1D("D$DIS_DIAB")
ds.table2D("D$DIS_DIAB", "D$GENDER")
```

Or even some statistical modelling. In this case we want to assess whether sex (GENDER) or trigrycerids (LAB_TRIG) are risk factors for diabetes (DIS_DIAB)

```{r glm_D}
mod <- ds.glm(DIS_DIAB ~ LAB_TRIG + GENDER, 
       data = "D" , family="binomial")
mod$coeff
```

As usual the connection must be closed

```{r close_conn_D}
datashield.logout(conns)
```


